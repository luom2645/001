# NovelForge Sentinel Pro - 技术选型建议

## 1. 核心技术栈推荐

| 领域 | 技术选型 | 理由 |
| --- | --- | --- |
| **客户端框架** | **Flutter** | 业界领先的跨平台UI工具包，提供高性能、单一代码库和富有表现力的UI。其桌面端支持已成熟，社区生态活跃，是实现本项目目标的不二之选。 |
| **后端服务** | **Supabase** | 一体化的“Backend-as-a-Service”平台，基于开源的PostgreSQL。提供了认证、数据库、存储、Edge Functions等所有必需组件，极大地简化了后端开发和部署。 |
| **底层安全/原生模块** | **Rust** | 兼具C++的性能和内存安全保证。其优秀的FFI支持和跨平台编译能力，使其成为开发硬件指纹获取、反调试和本地AI集成等核心原生模块的最佳选择。 |
| **本地AI引擎** | **llama.cpp / GGUF** | `llama.cpp`是目前在消费级硬件上运行LLM的最高性能引擎之一。`GGUF`作为其标准模型格式，得到了社区的广泛支持，模型资源丰富。 |
| **状态管理 (Flutter)** | **BLoC / Cubit** | 成熟、可预测的状态管理库，有助于构建可测试、可维护的大型应用。Cubit作为其轻量级版本，上手简单，适合处理大部分UI状态。 |
| **打包与分发** | **flutter_distributor** | 自动化打包工具，可以配置一次，为Windows (MSIX), macOS (DMG) 和 Linux (AppImage) 生成标准化的安装包，显著简化发布流程。 |

## 2. 实施路径建议

**阶段一：核心后端与认证 (Sprint 1-2)**
1.  **搭建Supabase项目**: 初始化项目，配置数据库。
2.  **设计核心数据库表**: 完成`profiles`, `licenses`, `devices`表的设计和创建。
3.  **实现用户认证**: 在Flutter应用中集成Supabase Auth，完成用户注册、登录、登出流程。
4.  **构建基础RLS策略**: 为`profiles`表设置RLS策略，确保用户只能访问自己的数据。

**阶段二：硬件绑定与许可证激活 (Sprint 3-4)**
1.  **开发原生安全模块 (Rust)**: 实现跨平台的硬件指纹获取功能。
2.  **FFI集成**: 在Flutter中通过FFI调用Rust模块。
3.  **开发Edge Functions**: 创建`activate-license`和`verify-device`函数。
4.  **完成激活流程**: 在Flutter应用中构建UI，完成从输入卡密到激活绑定的完整流程。

**阶段三：AI模型集成 (Sprint 5-6)**
1.  **集成云端AI**: 开发`proxy-ai-service` Edge Function，实现对至少一种云端AI（如OpenAI）的代理调用。
2.  **构建AI聊天界面**: 在Flutter中创建基础的文本生成UI。
3.  **集成`llama.cpp`**: 将`llama.cpp`编译为库，并通过FFI在Flutter中实现本地模型的调用。
4.  **统一AI服务接口**: 设计抽象的`AiService`，统一管理云端和本地模型的调用。

**阶段四：核心功能与多级权限 (Sprint 7-8)**
1.  **开发小说编辑器**: 构建应用的核心功能界面。
2.  **实现三级权限体系**: 在数据库中加入`role`和`reseller_id`等字段，并编写相应的RLS策略。
3.  **开发管理后台**: 为管理员和代理商创建管理用户和许可证的UI。
4.  **实现审计日志**: 创建`audit_logs`表和触发器。

**阶段五：安全、监控与发布 (Sprint 9-10)**
1.  **实现E2EE**: 开发端到端加密功能。
2.  **完善安全防护**: 开发反调试、代码混淆和完整性校验功能。
3.  **设置监控与告警**: 创建定期的安全扫描函数和告警机制。
4.  **打包和分发**: 使用`flutter_distributor`为三大桌面平台打包，准备发布。
