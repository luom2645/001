# NovelForge Sentinel Pro - 安全性分析报告

## 1. 威胁建模与分析

| 威胁类别 | 具体威胁描述 | 潜在影响 | 防护方案 |
| --- | --- | --- | --- |
| **客户端攻击** | **逆向工程与破解**：攻击者反编译Flutter应用，修改验证逻辑，绕过硬件绑定。 | 软件被免费盗用，商业利益受损。 | **代码混淆**、**完整性校验**、**反调试技术**、**FFI调用原生安全模块**。 |
| | **内存抓取**：攻击者使用调试工具dump应用内存，试图获取敏感数据（如解密后的密钥或文本）。 | E2EE密钥、用户敏感数据泄露。 | **内存加密**、**用后即焚**（敏感数据只在需要时解密）、**Guard Pages**。 |
| **认证与授权** | **凭证破解**：对用户账户进行暴力破解或撞库攻击。 | 账户被盗，用户数据泄露。 | **Supabase Auth内置的速率限制**、**强制强密码策略**、**监控登录失败率并告警**。 |
| | **权限绕过**：恶意用户试图通过API漏洞访问不属于自己的数据。 | 用户数据隔离被破坏，隐私泄露。 | **强制启用并严格编写行级安全（RLS）策略**，确保所有数据访问都经过`auth.uid()`的校验。 |
| **后端服务攻击** | **API密钥泄露**：第三方服务（AI模型, 支付）的API密钥从后端泄露。 | 攻击者可滥用API，造成巨额财务损失。 | **将所有密钥存储在Supabase Secrets Manager中**，只能由Edge Functions通过环境变量访问，绝不暴露给客户端或日志。 |
| | **SQL注入**：尽管Supabase客户端库能预防典型SQL注入，但不规范的数据库函数或Edge Function可能存在风险。 | 数据泄露、数据被篡改或删除。 | **使用参数化查询**，**严格审查所有自定义SQL函数**，**遵循最小权限原则**为数据库角色授权。 |
| | **拒绝服务（DoS）攻击**：恶意请求大量消耗API或数据库资源，导致服务瘫痪。 | 正常用户无法使用服务。 | **Supabase内置的DDoS防护**、**在Edge Function中实现速率限制**、**监控API使用情况并对异常流量告警**。 |
| **数据安全** | **数据传输被窃听**：在不安全的网络环境下，客户端与服务器的通信被中间人攻击。 | 用户凭证、敏感数据在传输中泄露。 | **默认且强制的TLS 1.3加密通信**。 |
| | **数据库泄露**：即使数据库备份被盗，攻击者也能直接读取用户数据。 | 所有未加密的用户数据全部泄露。 | **为最敏感的数据（如小说内容）提供可选的端到端加密（E2EE）**。对数据库本身进行加密存储（由云服务商提供）。 |
| **供应链攻击** | **恶意依赖包**：引入的第三方Flutter插件或NPM包包含恶意代码。 | 可能导致客户端或后端存在后门，数据被窃取。 | **定期审查和更新依赖项**，**使用信誉良好的库**，**运行依赖项安全扫描工具（如`snyk`）**。 |

## 2. 核心防护策略总结

1.  **客户端不可信原则**: 永远不要信任来自客户端的任何输入。所有的验证、业务逻辑处理和第三方API调用都必须在后端（Supabase Edge Functions）完成。

2.  **深度防御 (Defense in Depth)**: 采用多层安全措施。例如，同时使用代码混淆、反调试和完整性校验来保护客户端，而不是只依赖一种方法。

3.  **最小权限原则 (Principle of Least Privilege)**:无论是数据库角色还是应用内的用户角色，都只授予其完成任务所必需的最小权限。RLS是实现这一原则的核心工具。

4.  **将安全左移 (Shift-Left Security)**: 在开发过程的早期就考虑安全问题，而不是在开发完成后才进行安全审计。在代码审查（Code Review）阶段就应关注安全相关的代码。

5.  **全面的监控与告警**: 建立主动的安全监控体系。不仅要记录日志，更要能从日志中自动发现异常并及时告警，以便快速响应。

6.  **端到端加密作为最终保障**: 对于用户的核心私密数据（小说），提供E2EE选项。这是在即使所有其他服务器端防线都被突破的情况下，保护用户数据安全的最后一道屏障。